<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Encounter Alien Manager</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="shortcut icon" href="favicon.ico">
    <style>
        :root {
            --bg-color: #0b0d17;
            --card-bg: #15192b;
            --text-main: #e0e6ed;
            --text-muted: #94a3b8;
            --accent: #facc15;
            --border: #2d3748;
            --c-green: #22c55e;
            --c-yellow: #eab308;
            --c-red: #ef4444;
            --c-purple: #a855f7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 0;
        }

        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(21, 25, 43, 0.98);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
            position: sticky;
            top: 0;
            z-index: 1000;
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        header.header-hidden {
            transform: translateY(-100%);
        }

        .floating-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s;
        }

        .floating-btn.visible {
            display: flex;
        }

        h1 {
            margin: 0;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.8rem;
            text-shadow: 0 0 15px rgba(250, 204, 21, 0.3);
        }

        .controls-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            width: 100%;
            max-width: 900px;
            flex-wrap: wrap;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            flex: 2;
            min-width: 200px;
        }

        .clear-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #94a3b8;
            font-size: 1.2rem;
            display: none;
            user-select: none;
        }

        .clear-icon:hover {
            color: white;
        }

        input[type="text"],
        select,
        button {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-size: 0.95rem;
            height: 40px;
            box-sizing: border-box;
        }

        input[type="text"] {
            background: #0f121f;
            color: white;
            width: 100%;
            min-width: 200px;
        }

        select {
            background: #0f121f;
            color: white;
            cursor: pointer;
            flex: 1;
            min-width: 150px;
        }

        button {
            background: var(--accent);
            color: #000;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            white-space: nowrap;
            flex: 0;
            transition: filter 0.2s;
        }

        button:hover {
            filter: brightness(1.1);
        }

        .filters-row {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 5px;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-muted);
            font-weight: bold;
            margin-right: 5px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            user-select: none;
        }

        .cb-green {
            accent-color: var(--c-green);
        }

        .cb-yellow {
            accent-color: var(--c-yellow);
        }

        .cb-red {
            accent-color: var(--c-red);
        }

        .result-count {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 20px;
            font-size: 1rem;
            font-weight: 500;
        }

        .result-count span {
            color: var(--accent);
            font-weight: bold;
        }

        @media (max-width: 700px) {
            header {
                padding: 10px;
                gap: 10px;
            }

            h1 {
                font-size: 1.4rem;
            }

            .controls-row {
                flex-direction: column;
                gap: 8px;
            }

            input[type="text"],
            select,
            button {
                width: 100%;
            }

            .filters-row {
                gap: 10px;
                justify-content: center;
            }

            .filter-group {
                flex-wrap: wrap;
                justify-content: center;
            }

            .filter-group.extras {
                border-left: none !important;
                padding-left: 0 !important;
                margin-top: 5px;
                border-top: 1px solid var(--border);
                padding-top: 10px;
                width: 100%;
            }

            .filter-label.extras-label {
                display: none;
            }
        }

        .alien-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding-bottom: 40px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .card-image-container {
            width: 100%;
            height: 220px;
            overflow: hidden;
            position: relative;
            background: #fff;
            border-bottom: 4px solid var(--accent);
        }

        .card-image-container.alt-border {
            border-bottom-color: var(--c-purple);
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top center;
        }

        .card-image-title {
            position: absolute;
            top: 0;
            padding-top: 4px;
            left: 0;
            width: 100%;
            text-align: center;
            font-family: 'Impact', 'Arial Black', sans-serif;
            font-size: 1.6rem;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 10;
            padding-left: 35px;
            padding-right: 35px;
            box-sizing: border-box;
            text-shadow: 2px 0 0 #fff, -2px 0 0 #fff, 0 2px 0 #fff, 0 -2px 0 #fff,
                1px 1px #fff, -1px -1px #fff, 1px -1px #fff, -1px 1px #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (max-width: 600px) {
            .card-image-title {
                font-size: 1.4rem;
                padding-top: 6px;
                padding-left: 25px;
                padding-right: 25px;
            }

            .alien-grid {
                grid-template-columns: 1fr;
            }
        }

        .badges-container {
            position: absolute;
            bottom: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .badge {
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 3px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .alert-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .expansion-tag {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            z-index: 5;
        }

        .card-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .aka-info {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 10px;
            font-style: italic;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .aka-info strong {
            color: var(--accent);
            text-transform: uppercase;
            font-style: normal;
        }

        .power-summary {
            font-size: 1rem;
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .power-block {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #cbd5e1;
            border-left: 2px solid var(--text-muted);
            text-align: justify;
            hyphens: auto;
        }

        .power-block b {
            color: #fff;
            font-weight: 700;
        }

        .action-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            border-color: var(--text-main);
        }

        .flare-btn {
            border-color: var(--accent);
            color: var(--accent);
            font-weight: bold;
            text-transform: uppercase;
        }

        .flare-btn:hover {
            background: var(--accent);
            color: #000;
        }

        .expandable-text {
            display: none;
            margin-top: 10px;
            font-size: 0.85rem;
            padding: 10px;
            border-radius: 6px;
            text-align: justify;
        }

        .expandable-text.show {
            display: block;
        }

        .flare-text {
            background: rgba(250, 204, 21, 0.1);
            border: 1px solid rgba(250, 204, 21, 0.3);
            color: #e2e8f0;
        }

        .flare-title {
            color: var(--accent);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
            margin-bottom: 4px;
            margin-top: 10px;
            display: block;
        }

        .flare-title:first-child {
            margin-top: 0;
        }

        .history-text {
            color: #94a3b8;
            font-style: italic;
            border-top: 1px solid var(--border);
        }

        .timing-block {
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
        }

        .timing-header {
            color: var(--text-muted);
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
            text-transform: uppercase;
            font-size: 0.75rem;
        }

        .timing-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .timing-value {
            color: var(--text-main);
            font-weight: 500;
        }

        .phases-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin-top: 8px;
        }

        .phase-tag {
            background: #1e293b;
            color: #64748b;
            padding: 4px;
            text-align: center;
            border-radius: 4px;
            font-size: 0.7rem;
            border: 1px solid #334155;
        }

        .phase-tag.active {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border-color: #22c55e;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <header>
        <h1>Cosmic Encounter</h1>

        <div class="controls-row">
            <div class="search-wrapper">
                <input type="text" id="searchInput" placeholder="Buscar alien..." onkeyup="filterAliens()">
                <span id="clearSearch" class="clear-icon" onclick="clearSearch()">√ó</span>
            </div>
            <select id="expansionFilter" onchange="filterAliens()">
                <option value="all">Todas as Expans√µes</option>
                <option value="Base Game">Base Game</option>
                <option value="Cosmic Incursion">Cosmic Incursion</option>
                <option value="Cosmic Conflict">Cosmic Conflict</option>
                <option value="Cosmic Alliance">Cosmic Alliance</option>
                <option value="Cosmic Storm">Cosmic Storm</option>
                <option value="Cosmic Dominion">Cosmic Dominion</option>
                <option value="Cosmic Eons">Cosmic Eons</option>
                <option value="Cosmic Odyssey">Cosmic Odyssey</option>
                <option value="Cosmic Odyssey">Cosmic Odyssey</option>

            </select>
            <button onclick="toggleLanguage()" id="langBtn">üá∫üá∏ English</button>
        </div>

        <div class="filters-row">
            <div class="filter-group">
                <span class="filter-label" id="labelAlert">N√≠vel:</span>
                <label class="checkbox-label"><input type="checkbox" class="cb-green" value="green" checked
                        onchange="filterAliens()"> üü¢</label>
                <label class="checkbox-label"><input type="checkbox" class="cb-yellow" value="yellow" checked
                        onchange="filterAliens()"> üü°</label>
                <label class="checkbox-label"><input type="checkbox" class="cb-red" value="red" checked
                        onchange="filterAliens()"> üî¥</label>
            </div>
            <div class="filter-group extras" style="border-left: 1px solid var(--border); padding-left: 15px;">
                <span class="filter-label extras-label">Extras:</span>
                <label class="checkbox-label" title="Com Prepara√ß√£o"><input type="checkbox" id="checkSetup"
                        onchange="filterAliens()"> ‚öôÔ∏è <span id="labelSetup">Prepara√ß√£o</span></label>
                <label class="checkbox-label" title="Com Componentes"><input type="checkbox" id="checkComponents"
                        onchange="filterAliens()"> üì¶ <span id="labelTokens">Fichas</span></label>
                <label class="checkbox-label" title="Com Cartas de Ess√™ncia"><input type="checkbox" id="checkEssence"
                        onchange="filterAliens()"> ‚ú® <span id="labelEssence">Ess√™ncia</span></label>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="resultCount" class="result-count"></div>
        <div id="alienGrid" class="alien-grid"></div>
    </div>

    <button id="showFiltersBtn" class="floating-btn" onclick="showHeader()">üîç</button>

    <script>window.aliensData = [];</script>

    <script src="images.js" defer></script>
    <script src="aliens_base_game.js" defer></script>
    <script src="aliens_cosmic_incursion.js" defer></script>
    <script src="aliens_cosmic_conflict.js" defer></script>
    <script src="aliens_cosmic_alliance.js" defer></script>
    <script src="aliens_cosmic_storm.js" defer></script>
    <script src="aliens_cosmic_dominion.js" defer></script>
    <script src="aliens_cosmic_eons.js" defer></script>
    <script src="aliens_cosmic_odyssey.js" defer></script>


    <script>
        let currentLang = 'pt';

        // --- METADADOS OFICIAIS FFG ---
        const alienMetadata = {
            // --- BASE GAME (50) ---
            amoeba: { color: 'yellow', comp: false, exp: 'Base Game' }, anti_matter: { color: 'yellow', comp: false, exp: 'Base Game' }, barbarian: { color: 'green', comp: false, exp: 'Base Game' }, calculator: { color: 'yellow', comp: false, exp: 'Base Game' }, chosen: { color: 'green', comp: false, exp: 'Base Game' }, citadel: { color: 'red', comp: true, exp: 'Base Game' }, clone: { color: 'green', comp: false, exp: 'Base Game' }, cudgel: { color: 'green', comp: false, exp: 'Base Game' }, demon: { color: 'yellow', comp: false, exp: 'Base Game' }, dictator: { color: 'red', comp: false, exp: 'Base Game' }, fido: { color: 'yellow', comp: false, exp: 'Base Game' }, filch: { color: 'green', comp: false, exp: 'Base Game' }, fodder: { color: 'yellow', comp: false, exp: 'Base Game' }, gambler: { color: 'red', comp: false, exp: 'Base Game' }, grudge: { color: 'red', comp: true, exp: 'Base Game' }, hacker: { color: 'green', comp: false, exp: 'Base Game' }, hate: { color: 'yellow', comp: false, exp: 'Base Game' }, healer: { color: 'yellow', comp: false, exp: 'Base Game' }, human: { color: 'yellow', comp: false, exp: 'Base Game' }, kamikaze: { color: 'yellow', comp: false, exp: 'Base Game' }, loser: { color: 'green', comp: false, exp: 'Base Game' }, machine: { color: 'red', comp: false, exp: 'Base Game' }, macron: { color: 'green', comp: false, exp: 'Base Game' }, masochist: { color: 'red', comp: false, exp: 'Base Game' }, mind: { color: 'yellow', comp: false, exp: 'Base Game' }, mirror: { color: 'yellow', comp: false, exp: 'Base Game' }, miser: { color: 'green', comp: true, exp: 'Base Game' }, mite: { color: 'yellow', comp: false, exp: 'Base Game' }, mutant: { color: 'green', comp: false, exp: 'Base Game' }, observer: { color: 'green', comp: false, exp: 'Base Game' }, oracle: { color: 'green', comp: false, exp: 'Base Game' }, pacifist: { color: 'green', comp: false, exp: 'Base Game' }, parasite: { color: 'green', comp: false, exp: 'Base Game' }, philanthropist: { color: 'yellow', comp: false, exp: 'Base Game' }, reincarnator: { color: 'yellow', comp: false, exp: 'Base Game' }, remora: { color: 'yellow', comp: false, exp: 'Base Game' }, reserve: { color: 'green', comp: false, exp: 'Base Game' }, shadow: { color: 'yellow', comp: false, exp: 'Base Game' }, sorcerer: { color: 'green', comp: false, exp: 'Base Game' }, spiff: { color: 'green', comp: false, exp: 'Base Game' }, tick_tock: { color: 'yellow', comp: true, exp: 'Base Game' }, trader: { color: 'green', comp: false, exp: 'Base Game' }, tripler: { color: 'red', comp: false, exp: 'Base Game' }, vacuum: { color: 'green', comp: false, exp: 'Base Game' }, virus: { color: 'red', comp: false, exp: 'Base Game' }, void: { color: 'red', comp: false, exp: 'Base Game' }, vulch: { color: 'green', comp: false, exp: 'Base Game' }, warpish: { color: 'red', comp: false, exp: 'Base Game' }, warrior: { color: 'green', comp: true, exp: 'Base Game' }, will: { color: 'green', comp: false, exp: 'Base Game' }, zombie: { color: 'green', comp: false, exp: 'Base Game' },
            // --- COSMIC INCURSION (20) ---
            bully: { color: 'yellow', comp: false, exp: 'Cosmic Incursion' }, chronos: { color: 'yellow', comp: false, exp: 'Cosmic Incursion' }, cryo: { color: 'yellow', comp: true, exp: 'Cosmic Incursion' }, deuce: { color: 'yellow', comp: true, exp: 'Cosmic Incursion' }, disease: { color: 'red', comp: false, exp: 'Cosmic Incursion' }, ethic: { color: 'green', comp: false, exp: 'Cosmic Incursion' }, fungus: { color: 'yellow', comp: true, exp: 'Cosmic Incursion' }, fury: { color: 'green', comp: true, exp: 'Cosmic Incursion' }, genius: { color: 'red', comp: false, exp: 'Cosmic Incursion' }, ghoul: { color: 'red', comp: false, exp: 'Cosmic Incursion' }, guerrilla: { color: 'green', comp: false, exp: 'Cosmic Incursion' }, leviathan: { color: 'yellow', comp: true, exp: 'Cosmic Incursion' }, locust: { color: 'yellow', comp: true, exp: 'Cosmic Incursion' }, magician: { color: 'red', comp: false, exp: 'Cosmic Incursion' }, mercenary: { color: 'green', comp: false, exp: 'Cosmic Incursion' }, merchant: { color: 'yellow', comp: false, exp: 'Cosmic Incursion' }, plant: { color: 'red', comp: false, exp: 'Cosmic Incursion' }, seeker: { color: 'yellow', comp: false, exp: 'Cosmic Incursion' }, sniveler: { color: 'yellow', comp: false, exp: 'Cosmic Incursion' }, symbiote: { color: 'green', comp: true, exp: 'Cosmic Incursion' },
            // --- COSMIC CONFLICT (20) ---
            cavalry: { color: 'green', comp: false, exp: 'Cosmic Conflict' }, changeling: { color: 'green', comp: false, exp: 'Cosmic Conflict' }, empath: { color: 'green', comp: false, exp: 'Cosmic Conflict' }, filth: { color: 'red', comp: false, exp: 'Cosmic Conflict' }, glutton: { color: 'green', comp: false, exp: 'Cosmic Conflict' }, graviton: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, industrialist: { color: 'yellow', comp: true, exp: 'Cosmic Conflict' }, invader: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, lunatic: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, mimic: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, prophet: { color: 'red', comp: false, exp: 'Cosmic Conflict' }, relic: { color: 'red', comp: false, exp: 'Cosmic Conflict' }, saboteur: { color: 'red', comp: true, exp: 'Cosmic Conflict' }, sadist: { color: 'red', comp: false, exp: 'Cosmic Conflict' }, siren: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, the_claw: { color: 'red', comp: true, exp: 'Cosmic Conflict' }, trickster: { color: 'green', comp: false, exp: 'Cosmic Conflict' }, visionary: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, warhawk: { color: 'yellow', comp: false, exp: 'Cosmic Conflict' }, xenophile: { color: 'green', comp: false, exp: 'Cosmic Conflict' },
            // --- COSMIC ALLIANCE (20) ---
            animal: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' }, bandit: { color: 'red', comp: false, exp: 'Cosmic Alliance' }, butler: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' }, chrysalis: { color: 'red', comp: true, exp: 'Cosmic Alliance' }, crystal: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' }, cyborg: { color: 'yellow', comp: true, exp: 'Cosmic Alliance' }, extortionist: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' }, general: { color: 'green', comp: false, exp: 'Cosmic Alliance' }, gorgon: { color: 'red', comp: false, exp: 'Cosmic Alliance' }, horde: { color: 'red', comp: true, exp: 'Cosmic Alliance' }, lightning: { color: 'yellow', comp: true, exp: 'Cosmic Alliance' }, poison: { color: 'red', comp: false, exp: 'Cosmic Alliance' }, pygmy: { color: 'green', comp: true, exp: 'Cosmic Alliance' }, reborn: { color: 'green', comp: false, exp: 'Cosmic Alliance' }, remote: { color: 'red', comp: true, exp: 'Cosmic Alliance' }, sapient: { color: 'green', comp: true, exp: 'Cosmic Alliance' }, schizoid: { color: 'red', comp: true, exp: 'Cosmic Alliance' }, skeptic: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' }, sting: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' }, winner: { color: 'yellow', comp: false, exp: 'Cosmic Alliance' },
            // --- COSMIC STORM (25) ---
            arcade: { color: 'yellow', comp: true, exp: 'Cosmic Storm' }, brute: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, bulwark: { color: 'green', comp: false, exp: 'Cosmic Storm' }, converter: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, coordinator: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, dervish: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, grumpus: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, mouth: { color: 'red', comp: true, exp: 'Cosmic Storm' }, neighbor: { color: 'green', comp: false, exp: 'Cosmic Storm' }, outlaw: { color: 'green', comp: false, exp: 'Cosmic Storm' }, patriot: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, phantasm: { color: 'green', comp: false, exp: 'Cosmic Storm' }, roach: { color: 'red', comp: true, exp: 'Cosmic Storm' }, scavenger: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, sloth: { color: 'yellow', comp: true, exp: 'Cosmic Storm' }, sneak: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, squee: { color: 'red', comp: false, exp: 'Cosmic Storm' }, swindler: { color: 'red', comp: true, exp: 'Cosmic Storm' }, sycophant: { color: 'yellow', comp: true, exp: 'Cosmic Storm' }, tide: { color: 'yellow', comp: true, exp: 'Cosmic Storm' }, tyrant: { color: 'red', comp: true, exp: 'Cosmic Storm' }, vox: { color: 'green', comp: false, exp: 'Cosmic Storm' }, worm: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, wormhole: { color: 'yellow', comp: false, exp: 'Cosmic Storm' },
            // --- COSMIC DOMINION (30) ---
            ace: { color: 'red', comp: false, exp: 'Cosmic Dominion' }, alchemist: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, angler: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, aristocrat: { color: 'red', comp: false, exp: 'Cosmic Dominion' }, bride: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, daredevil: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, diplomat: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, doppelganger: { color: 'red', comp: false, exp: 'Cosmic Dominion' }, engineer: { color: 'yellow', comp: true, exp: 'Cosmic Dominion' }, explorer: { color: 'yellow', comp: true, exp: 'Cosmic Dominion' }, greenhorn: { color: 'green', comp: false, exp: 'Cosmic Dominion' }, host: { color: 'yellow', comp: true, exp: 'Cosmic Dominion' }, joker: { color: 'red', comp: true, exp: 'Cosmic Dominion' }, judge: { color: 'red', comp: false, exp: 'Cosmic Dominion' }, laser: { color: 'green', comp: false, exp: 'Cosmic Dominion' }, lizard: { color: 'green', comp: true, exp: 'Cosmic Dominion' }, love: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, mesmer: { color: 'red', comp: false, exp: 'Cosmic Dominion' }, mirage: { color: 'green', comp: false, exp: 'Cosmic Dominion' }, muckraker: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, pentaform: { color: 'red', comp: true, exp: 'Cosmic Dominion' }, pickpocket: { color: 'green', comp: false, exp: 'Cosmic Dominion' }, pirate: { color: 'yellow', comp: true, exp: 'Cosmic Dominion' }, quartermaster: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, reactor: { color: 'red', comp: true, exp: 'Cosmic Dominion' }, tourist: { color: 'yellow', comp: true, exp: 'Cosmic Dominion' }, usurper: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, voyager: { color: 'yellow', comp: false, exp: 'Cosmic Dominion' }, whirligig: { color: 'green', comp: false, exp: 'Cosmic Dominion' }, yin_yang: { color: 'yellow', comp: true, exp: 'Cosmic Dominion' },
            // --- COSMIC EONS (30) ---
            ai: { color: 'red', comp: true, exp: 'Cosmic Eons' }, alien: { color: 'red', comp: true, exp: 'Cosmic Eons' }, anarchist: { color: 'red', comp: true, exp: 'Cosmic Eons' }, architect: { color: 'red', comp: false, exp: 'Cosmic Eons' }, assistant: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, bleeding_heart: { color: 'green', comp: false, exp: 'Cosmic Eons' }, cloak: { color: 'red', comp: false, exp: 'Cosmic Eons' }, coward: { color: 'yellow', comp: false, exp: 'Cosmic Eons' }, crusher: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, emperor: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, evil_twin: { color: 'red', comp: true, exp: 'Cosmic Eons' }, fire_dancer: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, hunger: { color: 'green', comp: false, exp: 'Cosmic Eons' }, hypochondriac: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, klutz: { color: 'yellow', comp: false, exp: 'Cosmic Eons' }, maven: { color: 'red', comp: true, exp: 'Cosmic Eons' }, moocher: { color: 'red', comp: true, exp: 'Cosmic Eons' }, multitude: { color: 'green', comp: true, exp: 'Cosmic Eons' }, nanny: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, nightmare: { color: 'red', comp: true, exp: 'Cosmic Eons' }, oligarch: { color: 'red', comp: true, exp: 'Cosmic Eons' }, pack_rat: { color: 'yellow', comp: false, exp: 'Cosmic Eons' }, particle: { color: 'red', comp: true, exp: 'Cosmic Eons' }, peddler: { color: 'red', comp: true, exp: 'Cosmic Eons' }, perfectionist: { color: 'green', comp: true, exp: 'Cosmic Eons' }, porcupine: { color: 'yellow', comp: false, exp: 'Cosmic Storm' }, pretender: { color: 'red', comp: false, exp: 'Cosmic Eons' }, sheriff: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, surgeon: { color: 'yellow', comp: true, exp: 'Cosmic Eons' }, the_cult: { color: 'red', comp: true, exp: 'Cosmic Eons' }, tortoise: { color: 'red', comp: true, exp: 'Cosmic Eons' },
            // --- COSMIC ODYSSEY (30) ---
            assessor: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, aura: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, boomerang: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, booster: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }, bubble: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, cosmos: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, decoy: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, delegator: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, dragon: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, extractor: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }, force: { color: 'red', comp: false, exp: 'Cosmic Odyssey' }, geek: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, gremlin: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, guardian: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }, hurtz: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, inferno: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, insect: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, lemming: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, lloyd: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, magnet: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }, negator: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, phantom: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, silencer: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, tentacle: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }, the_meek: { color: 'red', comp: false, exp: 'Cosmic Odyssey' }, throwback: { color: 'red', comp: false, exp: 'Cosmic Odyssey' }, vector: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, witch: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, wrack: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, zilch: { color: 'red', comp: true, exp: 'Cosmic Odyssey' },
            // --- ALTERNATE TIMELINE (12) ---
            brute_alternate: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, daredevil_alternate: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, demon_alternate: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, grumpus_alternate: { color: 'yellow', comp: false, exp: 'Cosmic Odyssey' }, locust_alternate: { color: 'yellow', comp: true, exp: 'Cosmic Odyssey' }, masochist_alternate: { color: 'red', comp: false, exp: 'Cosmic Odyssey' }, micron_alternate: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }, perfectionist_alternate: { color: 'green', comp: true, exp: 'Cosmic Odyssey' }, sadist_alternate: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, schizoid_alternate: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, void_alternate: { color: 'red', comp: true, exp: 'Cosmic Odyssey' }, zombie_alternate: { color: 'green', comp: false, exp: 'Cosmic Odyssey' }
        };

        const essenceAliens = [
            'ai', 'alien', 'anarchist', 'assistant', 'evil_twin', 'host', 'nanny', 'nightmare',
            'oligarch', 'pack_rat', 'pretender', 'sapient', 'sheriff', 'cosmos', 'negator',
            'witch', 'zilch', 'schizoid'
        ];

        function enrichAlienData() {
            window.aliensData.forEach(alien => {
                let meta = alienMetadata[alien.id];
                // Tenta busca normalizada caso n√£o encontre direto
                if (!meta) {
                    const key = Object.keys(alienMetadata).find(k => k.toLowerCase() === alien.id.toLowerCase());
                    if (key) meta = alienMetadata[key];
                }

                if (meta) {
                    alien.alert = meta.color;
                    alien.hasComponents = meta.comp;
                    alien.expansion = meta.exp;
                } else {
                    // Fallback para Base Game e Verde se n√£o achar
                    if (!alien.alert) alien.alert = 'green';
                    if (alien.hasComponents === undefined) alien.hasComponents = false;
                    if (!alien.expansion) alien.expansion = 'Base Game';
                }

                // Detecta Setup no texto se n√£o tiver sido definido
                if (alien.hasSetup === undefined) {
                    const ptPower = alien.power.pt || "";
                    const enPower = alien.power.en || "";
                    if (ptPower.includes("Prepara√ß√£o de Jogo:") || ptPower.includes("Game Setup:") || enPower.includes("Game Setup:")) {
                        alien.hasSetup = true;
                    } else {
                        alien.hasSetup = false;
                    }
                }

                if (essenceAliens.includes(alien.id.toLowerCase())) {
                    alien.hasEssence = true;
                } else {
                    alien.hasEssence = false;
                }
            });
        }

        function toggleLanguage() {
            currentLang = currentLang === 'pt' ? 'en' : 'pt';
            const btn = document.getElementById('langBtn');
            const input = document.getElementById('searchInput');

            const labelAlert = document.getElementById('labelAlert');
            const labelSetup = document.getElementById('labelSetup');
            const labelTokens = document.getElementById('labelTokens');

            if (currentLang === 'pt') {
                btn.innerText = "üá∫üá∏ English";
                input.placeholder = "Buscar alien...";
                labelAlert.innerText = "N√≠vel:";
                labelSetup.innerText = "Prepara√ß√£o";
                labelTokens.innerText = "Fichas";
                if (document.getElementById('labelEssence')) document.getElementById('labelEssence').innerText = "Ess√™ncia";
            } else {
                btn.innerText = "üáßüá∑ Portugu√™s";
                input.placeholder = "Search alien...";
                labelAlert.innerText = "Level:";
                labelSetup.innerText = "Setup";
                labelTokens.innerText = "Tokens";
                if (document.getElementById('labelEssence')) document.getElementById('labelEssence').innerText = "Essence";
            }
            updateExpansionCounts();
            filterAliens();
        }

        function toggleFlare(btn) {
            const flareText = btn.nextElementSibling;
            flareText.classList.toggle('show');
            const isPT = currentLang === 'pt';
            if (flareText.classList.contains('show')) {
                btn.innerText = isPT ? 'Esconder Flare' : 'Hide Flare';
            } else {
                btn.innerText = isPT ? 'Ver Flare' : 'View Flare';
            }
        }

        function getAlienImage(alienId) {
            const key = alienId.toUpperCase();
            // Tenta carregar do mapa de imagens
            if (window.alienImages && window.alienImages[key]) {
                return window.alienImages[key];
            }
            // Fallback para imagem local se n√£o estiver no mapa
            return 'img/vazio.jpg';
        }

        function toggleHistory(btn) {
            const text = btn.nextElementSibling;
            text.classList.toggle('show');
            btn.innerText = text.classList.contains('show') ?
                (currentLang === 'pt' ? 'Esconder Hist√≥ria' : 'Hide History') :
                (currentLang === 'pt' ? 'Ver Hist√≥ria' : 'Show History');
        }

        function updateExpansionCounts() {
            const counts = {};
            let total = 0;
            window.aliensData.forEach(alien => {
                total++;
                const exp = alien.expansion;
                counts[exp] = (counts[exp] || 0) + 1;
                if (alien.flare) {
                    // counts['flares'] = (counts['flares'] || 0) + 1;
                }
            });

            const select = document.getElementById('expansionFilter');
            const allText = currentLang === 'pt' ? "Todas as Expans√µes" : "All Expansions";
            select.options[0].text = `${allText} (${total})`;

            for (let i = 1; i < select.options.length; i++) {
                const opt = select.options[i];
                const key = opt.value;
                const count = counts[key] || 0;
                let baseName = key;

                opt.text = `${baseName} (${count})`;
            }
        }

        function clearSearch() {
            const input = document.getElementById('searchInput');
            input.value = '';
            input.focus();
            filterAliens();
        }

        function createTimingHtml(timingObj) {
            if (!timingObj) return '';

            const player = timingObj.player[currentLang];
            const choice = timingObj.choice[currentLang];
            const phases = timingObj.phases;

            const phaseNames = {
                startTurn: currentLang === 'pt' ? 'In√≠cio' : 'Start',
                regroup: currentLang === 'pt' ? 'Reagrupar' : 'Regroup',
                destiny: currentLang === 'pt' ? 'Destino' : 'Destiny',
                launch: currentLang === 'pt' ? 'Lan√ßar' : 'Launch',
                alliance: currentLang === 'pt' ? 'Alian√ßa' : 'Alliance',
                planning: currentLang === 'pt' ? 'Planejar' : 'Planning',
                reveal: currentLang === 'pt' ? 'Revelar' : 'Reveal',
                resolution: currentLang === 'pt' ? 'Resolu√ß√£o' : 'Resolution'
            };

            let phasesHtml = '';
            for (const [key, label] of Object.entries(phaseNames)) {
                const isActive = phases[key] ? ' active' : '';
                phasesHtml += `<div class="phase-tag${isActive}">${label}</div>`;
            }

            const usageLabel = currentLang === 'pt' ? 'Uso:' : 'Usage:';
            const choiceLabel = currentLang === 'pt' ? 'Tipo:' : 'Type:';

            return `
                <div class="timing-block">
                    <div class="timing-row">
                        <span class="timing-header">${usageLabel}</span>
                        <span class="timing-value">${player}</span>
                    </div>
                    <div class="timing-row">
                        <span class="timing-header">${choiceLabel}</span>
                        <span class="timing-value">${choice}</span>
                    </div>
                    <div class="phases-grid">
                        ${phasesHtml}
                    </div>
                </div>
            `;
        }

        function filterAliens() {
            const textTerm = document.getElementById('searchInput').value.toLowerCase();

            const clearBtn = document.getElementById('clearSearch');
            if (textTerm.length > 0) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }

            const expansionTerm = document.getElementById('expansionFilter').value;

            const showGreen = document.querySelector('.cb-green').checked;
            const showYellow = document.querySelector('.cb-yellow').checked;
            const showRed = document.querySelector('.cb-red').checked;

            const requireSetup = document.getElementById('checkSetup').checked;
            const requireComponents = document.getElementById('checkComponents').checked;
            const requireEssence = document.getElementById('checkEssence').checked;

            const grid = document.getElementById('alienGrid');
            const resultCount = document.getElementById('resultCount');
            grid.innerHTML = '';

            const sortedAliens = window.aliensData.sort((a, b) => {
                const nameA = a.name[currentLang] || a.name.pt;
                const nameB = b.name[currentLang] || b.name.pt;
                return nameA.localeCompare(nameB);
            });

            const filtered = sortedAliens.filter(alien => {
                const namePT = (alien.name.pt || "").toLowerCase();
                const nameEN = (alien.name.en || "").toLowerCase();
                const aka = (alien.aka || "").toLowerCase();
                const id = (alien.id || "").toLowerCase();

                const matchesText = namePT.includes(textTerm) ||
                    nameEN.includes(textTerm) ||
                    aka.includes(textTerm) ||
                    id.includes(textTerm);

                let matchesExpansion = false;
                if (expansionTerm === 'all') {
                    matchesExpansion = true;
                } else {
                    matchesExpansion = alien.expansion === expansionTerm;
                }

                let matchesColor = false;
                if (alien.alert === 'green' && showGreen) matchesColor = true;
                if (alien.alert === 'yellow' && showYellow) matchesColor = true;
                if (alien.alert === 'red' && showRed) matchesColor = true;
                if (!alien.alert && showGreen) matchesColor = true;

                let matchesSetup = true;
                if (requireSetup && !alien.hasSetup) matchesSetup = false;

                let matchesComp = true;
                if (requireComponents && !alien.hasComponents) matchesComp = false;

                let matchesEssence = true;
                if (requireEssence && !alien.hasEssence) matchesEssence = false;

                return matchesText && matchesExpansion && matchesColor && matchesSetup && matchesComp && matchesEssence;
            });

            const foundText = currentLang === 'pt' ? 'encontrado(s)' : 'found';
            resultCount.innerHTML = `<span>${filtered.length}</span> alien(s) ${foundText}`;

            filtered.forEach(alien => {
                const card = document.createElement('div');
                card.className = 'card';

                const isAlternate = alien.id.toLowerCase().includes('_alternate');
                const borderClass = isAlternate ? ' alt-border' : '';

                const imageUrl = getAlienImage(alien.id);
                // Sempre exibe t√≠tulo em ingl√™s conforme solicitado
                const name = alien.name.en || alien.name.pt;
                const summary = alien.summary[currentLang] || alien.summary.pt;
                const powerText = alien.power[currentLang] || alien.power.pt;
                const history = alien.history[currentLang] || alien.history.pt;

                let badgesHtml = '';
                let colorClass = '';
                if (alien.alert === 'green') colorClass = 'var(--c-green)';
                else if (alien.alert === 'yellow') colorClass = 'var(--c-yellow)';
                else if (alien.alert === 'red') colorClass = 'var(--c-red)';
                else colorClass = '#999';

                badgesHtml += `<div class="badge"><span class="alert-dot" style="background:${colorClass}"></span></div>`;
                if (alien.hasSetup) badgesHtml += `<div class="badge">‚öôÔ∏è</div>`;
                if (alien.hasComponents) badgesHtml += `<div class="badge">üì¶</div>`;
                if (alien.hasEssence) badgesHtml += `<div class="badge">‚ú®</div>`;

                // AKA L√≥gica: Se PT, mostra AKA ou Nome PT se diferente do EN
                let akaField = '';
                if (currentLang === 'pt') {
                    let akaText = '';
                    if (alien.aka) {
                        akaText = alien.aka;
                    } else if (alien.name.pt && alien.name.pt !== alien.name.en) {
                        akaText = alien.name.pt;
                    }

                    if (akaText) {
                        akaField = `<div class="aka-info">Tamb√©m conhecido como: <strong>${akaText}</strong></div>`;
                    }
                }

                let flareHtml = '';
                if (alien.flare) {
                    const wildText = alien.flare.wild[currentLang];
                    const superText = alien.flare.super[currentLang];
                    const btnText = currentLang === 'pt' ? 'Ver Flare' : 'View Flare';

                    const wildTimingHtml = alien.flare.wild.timing ? createTimingHtml(alien.flare.wild.timing) : '';
                    const superTimingHtml = alien.flare.super.timing ? createTimingHtml(alien.flare.super.timing) : '';

                    flareHtml = `
                    <button class="action-btn flare-btn" onclick="toggleFlare(this)">${btnText}</button>
                    <div class="expandable-text flare-text">
                        <span class="flare-title">Wild</span>
                        <p>${wildText}</p>
                        ${wildTimingHtml}
                        <div style="margin-top:10px;"></div>
                        <span class="flare-title">Super</span>
                        <p>${superText}</p>
                        ${superTimingHtml}
                    </div>
                `;
                }

                const timingHtml = createTimingHtml(alien.timing);

                // Adiciona fallback de imagem vazio.jpg no onError
                card.innerHTML = `
                <div class="card-image-container${borderClass}">
                    <img src="${imageUrl}" alt="${name}" class="card-image" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='img/vazio.jpg';">
                    <div class="card-image-title">${name}</div>
                    <div class="expansion-tag">${alien.expansion}</div>
                    <div class="badges-container">${badgesHtml}</div>
                </div>
                <div class="card-content">
                    ${akaField}
                    <div class="power-summary">${summary}</div>
                    <div class="power-block">${powerText}</div>
                    ${timingHtml}
                    ${flareHtml}
                    <button class="action-btn history-btn" onclick="toggleHistory(this)">
                        ${currentLang === 'pt' ? 'Ver Hist√≥ria' : 'Show History'}
                    </button>
                    <div class="expandable-text history-text">${history}</div>
                </div>
            `;
                grid.appendChild(card);
            });

            if (filtered.length === 0) {
                grid.innerHTML = `<div style="color: #94a3b8; grid-column: 1/-1; text-align: center; padding: 40px; font-size: 1.2rem;">
                Nenhum alien encontrado. / No aliens found.
            </div>`;
            }
        }

        window.onload = function () {
            enrichAlienData();
            updateExpansionCounts();
            filterAliens();

            let lastScrollTop = 0;
            const header = document.querySelector('header');
            const floatBtn = document.getElementById('showFiltersBtn');

            window.addEventListener('scroll', function () {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (scrollTop > 100) {
                    // Scrolling down past threshold - hide header, show button
                    if (!header.classList.contains('header-hidden')) {
                        header.classList.add('header-hidden');
                        floatBtn.classList.add('visible');
                    }
                } else {
                    // At top - show header, hide button
                    header.classList.remove('header-hidden');
                    floatBtn.classList.remove('visible');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            });

            window.showHeader = function () {
                header.classList.remove('header-hidden');
                floatBtn.classList.remove('visible');
            };
        };
    </script>